Secure offline end-to-end encryption